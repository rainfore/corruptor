<div><img id="image" src="button.png" /></div>
<canvas id="canvas" width="200" height="200" style="border: 1px solid #ddd; background: #f4f4f4;"></canvas>
<a onclick="saveImage(this)" download="test.png">保存</a>


<script src="../../dist/corruptor.js"></script>
<script>
var img = document.getElementById('image');

function preImage(img, callback) {
    if(img.complete)
        callback();
    else
        img.onload = callback;
}

function saveImage($a) {
    var canvas = document.getElementById('canvas');
    $a.href = canvas.toDataURL('image/png').replace('image/png', 'image/octet-stream');
    $a.download = 'test.png';
}

preImage(img, function() {
    var canvas = document.getElementById('canvas');
    var width = canvas.width = img.width;
    var height = canvas.height = img.height;
    var context = canvas.getContext('2d');
    
    context.drawImage(img, 0, 0);
    var corruptor = new Corruptor(context.getImageData(0, 0, width, height));
    corruptor.corrupt();

    // trim
    width = canvas.width = corruptor.imageData.width;
    height = canvas.height = corruptor.imageData.height;
    context.putImageData(corruptor.testImageData, 0, 0);
});
</script>